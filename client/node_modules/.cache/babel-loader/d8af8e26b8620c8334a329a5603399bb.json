{"ast":null,"code":"/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * \n * @format\n */\n// flowlint ambiguous-object-type:error\n'use strict';\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _objectSpread2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectSpread2\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar RelayFeatureFlags = require('../util/RelayFeatureFlags');\n\nvar areEqual = require(\"fbjs/lib/areEqual\");\n\nvar invariant = require('invariant');\n\nvar isScalarAndEqual = require('../util/isScalarAndEqual');\n\nvar reportMissingRequiredFields = require('../util/reportMissingRequiredFields');\n\nvar warning = require(\"fbjs/lib/warning\");\n\nvar _require = require('../query/fetchQueryInternal'),\n    getPromiseForActiveRequest = _require.getPromiseForActiveRequest;\n\nvar _require2 = require('./RelayModernOperationDescriptor'),\n    createRequestDescriptor = _require2.createRequestDescriptor;\n\nvar _require3 = require('./RelayModernSelector'),\n    areEqualSelectors = _require3.areEqualSelectors,\n    createReaderSelector = _require3.createReaderSelector,\n    getSelectorsFromObject = _require3.getSelectorsFromObject;\n/**\n * A utility for resolving and subscribing to the results of a fragment spec\n * (key -> fragment mapping) given some \"props\" that determine the root ID\n * and variables to use when reading each fragment. When props are changed via\n * `setProps()`, the resolver will update its results and subscriptions\n * accordingly. Internally, the resolver:\n * - Converts the fragment map & props map into a map of `Selector`s.\n * - Removes any resolvers for any props that became null.\n * - Creates resolvers for any props that became non-null.\n * - Updates resolvers with the latest props.\n *\n * This utility is implemented as an imperative, stateful API for performance\n * reasons: reusing previous resolvers, callback functions, and subscriptions\n * all helps to reduce object allocation and thereby decrease GC time.\n *\n * The `resolve()` function is also lazy and memoized: changes in the store mark\n * the resolver as stale and notify the caller, and the actual results are\n * recomputed the first time `resolve()` is called.\n */\n\n\nvar RelayModernFragmentSpecResolver = /*#__PURE__*/function () {\n  function RelayModernFragmentSpecResolver(context, fragments, props, callback, rootIsQueryRenderer) {\n    var _this = this;\n\n    (0, _defineProperty2[\"default\"])(this, \"_onChange\", function () {\n      _this._stale = true;\n\n      if (typeof _this._callback === 'function') {\n        _this._callback();\n      }\n    });\n    this._callback = callback;\n    this._context = context;\n    this._data = {};\n    this._fragments = fragments;\n    this._props = {};\n    this._resolvers = {};\n    this._stale = false;\n    this._rootIsQueryRenderer = rootIsQueryRenderer;\n    this.setProps(props);\n  }\n\n  var _proto = RelayModernFragmentSpecResolver.prototype;\n\n  _proto.dispose = function dispose() {\n    for (var _key in this._resolvers) {\n      if (this._resolvers.hasOwnProperty(_key)) {\n        disposeCallback(this._resolvers[_key]);\n      }\n    }\n  };\n\n  _proto.resolve = function resolve() {\n    if (this._stale) {\n      // Avoid mapping the object multiple times, which could occur if data for\n      // multiple keys changes in the same event loop.\n      var prevData = this._data;\n      var nextData;\n\n      for (var _key2 in this._resolvers) {\n        if (this._resolvers.hasOwnProperty(_key2)) {\n          var resolver = this._resolvers[_key2];\n          var prevItem = prevData[_key2];\n\n          if (resolver) {\n            var nextItem = resolver.resolve();\n\n            if (nextData || nextItem !== prevItem) {\n              nextData = nextData || (0, _objectSpread2[\"default\"])({}, prevData);\n              nextData[_key2] = nextItem;\n            }\n          } else {\n            var prop = this._props[_key2];\n\n            var _nextItem = prop !== undefined ? prop : null;\n\n            if (nextData || !isScalarAndEqual(_nextItem, prevItem)) {\n              nextData = nextData || (0, _objectSpread2[\"default\"])({}, prevData);\n              nextData[_key2] = _nextItem;\n            }\n          }\n        }\n      }\n\n      this._data = nextData || prevData;\n      this._stale = false;\n    }\n\n    return this._data;\n  };\n\n  _proto.setCallback = function setCallback(callback) {\n    this._callback = callback;\n  };\n\n  _proto.setProps = function setProps(props) {\n    var ownedSelectors = getSelectorsFromObject(this._fragments, props);\n    this._props = {};\n\n    for (var _key3 in ownedSelectors) {\n      if (ownedSelectors.hasOwnProperty(_key3)) {\n        var ownedSelector = ownedSelectors[_key3];\n        var resolver = this._resolvers[_key3];\n\n        if (ownedSelector == null) {\n          if (resolver != null) {\n            resolver.dispose();\n          }\n\n          resolver = null;\n        } else if (ownedSelector.kind === 'PluralReaderSelector') {\n          if (resolver == null) {\n            resolver = new SelectorListResolver(this._context.environment, this._rootIsQueryRenderer, ownedSelector, this._onChange);\n          } else {\n            !(resolver instanceof SelectorListResolver) ? process.env.NODE_ENV !== \"production\" ? invariant(false, 'RelayModernFragmentSpecResolver: Expected prop `%s` to always be an array.', _key3) : invariant(false) : void 0;\n            resolver.setSelector(ownedSelector);\n          }\n        } else {\n          if (resolver == null) {\n            resolver = new SelectorResolver(this._context.environment, this._rootIsQueryRenderer, ownedSelector, this._onChange);\n          } else {\n            !(resolver instanceof SelectorResolver) ? process.env.NODE_ENV !== \"production\" ? invariant(false, 'RelayModernFragmentSpecResolver: Expected prop `%s` to always be an object.', _key3) : invariant(false) : void 0;\n            resolver.setSelector(ownedSelector);\n          }\n        }\n\n        this._props[_key3] = props[_key3];\n        this._resolvers[_key3] = resolver;\n      }\n    }\n\n    this._stale = true;\n  };\n\n  _proto.setVariables = function setVariables(variables, request) {\n    for (var _key4 in this._resolvers) {\n      if (this._resolvers.hasOwnProperty(_key4)) {\n        var resolver = this._resolvers[_key4];\n\n        if (resolver) {\n          resolver.setVariables(variables, request);\n        }\n      }\n    }\n\n    this._stale = true;\n  };\n\n  return RelayModernFragmentSpecResolver;\n}();\n/**\n * A resolver for a single Selector.\n */\n\n\nvar SelectorResolver = /*#__PURE__*/function () {\n  function SelectorResolver(environment, rootIsQueryRenderer, selector, callback) {\n    var _this2 = this;\n\n    (0, _defineProperty2[\"default\"])(this, \"_onChange\", function (snapshot) {\n      _this2._data = snapshot.data;\n      _this2._isMissingData = snapshot.isMissingData;\n      _this2._missingRequiredFields = snapshot.missingRequiredFields;\n\n      _this2._callback();\n    });\n\n    var _snapshot = environment.lookup(selector);\n\n    this._callback = callback;\n    this._data = _snapshot.data;\n    this._isMissingData = _snapshot.isMissingData;\n    this._missingRequiredFields = _snapshot.missingRequiredFields;\n    this._environment = environment;\n    this._rootIsQueryRenderer = rootIsQueryRenderer;\n    this._selector = selector;\n    this._subscription = environment.subscribe(_snapshot, this._onChange);\n  }\n\n  var _proto2 = SelectorResolver.prototype;\n\n  _proto2.dispose = function dispose() {\n    if (this._subscription) {\n      this._subscription.dispose();\n\n      this._subscription = null;\n    }\n  };\n\n  _proto2.resolve = function resolve() {\n    if (RelayFeatureFlags.ENABLE_RELAY_CONTAINERS_SUSPENSE === true && this._isMissingData === true) {\n      var _getPromiseForActiveR; // NOTE: This branch exists to handle the case in which:\n      // - A RelayModern container is rendered as a descendant of a Relay Hook\n      //   root using a \"partial\" renderPolicy (this means that eargerly\n      //   reading any cached data that is available instead of blocking\n      //   at the root until the whole query is fetched).\n      // - A parent Relay Hook didnt' suspend earlier on data being fetched,\n      //   either because the fragment data for the parent was available, or\n      //   the parent fragment didn't have any data dependencies.\n      // Even though our Flow types reflect the possiblity of null data, there\n      // might still be cases where it's not handled at runtime becuase the\n      // Flow types are being ignored, or simply not being used (for example,\n      // the case reported here: https://fburl.com/srnbucf8, was due to\n      // misuse of Flow types here: https://fburl.com/g3m0mqqh).\n      // Additionally, even though the null data might be handled without a\n      // runtime error, we might not suspend when we intended to if a parent\n      // Relay Hook (e.g. that is using @defer) decided not to suspend becuase\n      // it's immediate data was already available (even if it was deferred),\n      // or it didn't actually need any data (was just spreading other fragments).\n      // This should eventually go away with something like @optional, where we only\n      // suspend at specific boundaries depending on whether the boundary\n      // can be fulfilled or not.\n\n\n      var promise = (_getPromiseForActiveR = getPromiseForActiveRequest(this._environment, this._selector.owner)) !== null && _getPromiseForActiveR !== void 0 ? _getPromiseForActiveR : this._environment.getOperationTracker().getPromiseForPendingOperationsAffectingOwner(this._selector.owner);\n\n      if (promise != null) {\n        if (this._rootIsQueryRenderer) {\n          process.env.NODE_ENV !== \"production\" ? warning(false, 'Relay: Relay Container for fragment `%s` has missing data and ' + 'would suspend. When using features such as @defer or @module, ' + 'use `useFragment` instead of a Relay Container.', this._selector.node.name) : void 0;\n        } else {\n          process.env.NODE_ENV !== \"production\" ? warning(false, 'Relay: Relay Container for fragment `%s` suspended. When using ' + 'features such as @defer or @module, use `useFragment` instead ' + 'of a Relay Container.', this._selector.node.name) : void 0;\n          throw promise;\n        }\n      }\n    }\n\n    if (this._missingRequiredFields != null) {\n      reportMissingRequiredFields(this._environment, this._missingRequiredFields);\n    }\n\n    return this._data;\n  };\n\n  _proto2.setSelector = function setSelector(selector) {\n    if (this._subscription != null && areEqualSelectors(selector, this._selector)) {\n      return;\n    }\n\n    this.dispose();\n\n    var snapshot = this._environment.lookup(selector);\n\n    this._data = snapshot.data;\n    this._isMissingData = snapshot.isMissingData;\n    this._missingRequiredFields = snapshot.missingRequiredFields;\n    this._selector = selector;\n    this._subscription = this._environment.subscribe(snapshot, this._onChange);\n  };\n\n  _proto2.setVariables = function setVariables(variables, request) {\n    if (areEqual(variables, this._selector.variables)) {\n      // If we're not actually setting new variables, we don't actually want\n      // to create a new fragment owner, since areEqualSelectors relies on\n      // owner identity.\n      // In fact, we don't even need to try to attempt to set a new selector.\n      // When fragment ownership is not enabled, setSelector will also bail\n      // out since the selector doesn't really change, so we're doing it here\n      // earlier.\n      return;\n    } // NOTE: We manually create the request descriptor here instead of\n    // calling createOperationDescriptor() because we want to set a\n    // descriptor with *unaltered* variables as the fragment owner.\n    // This is a hack that allows us to preserve existing (broken)\n    // behavior of RelayModern containers while using fragment ownership\n    // to propagate variables instead of Context.\n    // For more details, see the summary of D13999308\n\n\n    var requestDescriptor = createRequestDescriptor(request, variables);\n    var selector = createReaderSelector(this._selector.node, this._selector.dataID, variables, requestDescriptor);\n    this.setSelector(selector);\n  };\n\n  return SelectorResolver;\n}();\n/**\n * A resolver for an array of Selectors.\n */\n\n\nvar SelectorListResolver = /*#__PURE__*/function () {\n  function SelectorListResolver(environment, rootIsQueryRenderer, selector, callback) {\n    var _this3 = this;\n\n    (0, _defineProperty2[\"default\"])(this, \"_onChange\", function (data) {\n      _this3._stale = true;\n\n      _this3._callback();\n    });\n    this._callback = callback;\n    this._data = [];\n    this._environment = environment;\n    this._resolvers = [];\n    this._stale = true;\n    this._rootIsQueryRenderer = rootIsQueryRenderer;\n    this.setSelector(selector);\n  }\n\n  var _proto3 = SelectorListResolver.prototype;\n\n  _proto3.dispose = function dispose() {\n    this._resolvers.forEach(disposeCallback);\n  };\n\n  _proto3.resolve = function resolve() {\n    if (this._stale) {\n      // Avoid mapping the array multiple times, which could occur if data for\n      // multiple indices changes in the same event loop.\n      var prevData = this._data;\n      var nextData;\n\n      for (var ii = 0; ii < this._resolvers.length; ii++) {\n        var prevItem = prevData[ii];\n\n        var nextItem = this._resolvers[ii].resolve();\n\n        if (nextData || nextItem !== prevItem) {\n          nextData = nextData || prevData.slice(0, ii);\n          nextData.push(nextItem);\n        }\n      }\n\n      if (!nextData && this._resolvers.length !== prevData.length) {\n        nextData = prevData.slice(0, this._resolvers.length);\n      }\n\n      this._data = nextData || prevData;\n      this._stale = false;\n    }\n\n    return this._data;\n  };\n\n  _proto3.setSelector = function setSelector(selector) {\n    var selectors = selector.selectors;\n\n    while (this._resolvers.length > selectors.length) {\n      var resolver = this._resolvers.pop();\n\n      resolver.dispose();\n    }\n\n    for (var ii = 0; ii < selectors.length; ii++) {\n      if (ii < this._resolvers.length) {\n        this._resolvers[ii].setSelector(selectors[ii]);\n      } else {\n        this._resolvers[ii] = new SelectorResolver(this._environment, this._rootIsQueryRenderer, selectors[ii], this._onChange);\n      }\n    }\n\n    this._stale = true;\n  };\n\n  _proto3.setVariables = function setVariables(variables, request) {\n    this._resolvers.forEach(function (resolver) {\n      return resolver.setVariables(variables, request);\n    });\n\n    this._stale = true;\n  };\n\n  return SelectorListResolver;\n}();\n\nfunction disposeCallback(disposable) {\n  disposable && disposable.dispose();\n}\n\nmodule.exports = RelayModernFragmentSpecResolver;","map":{"version":3,"sources":["/home/adamhanna/apps/relay-mongo-subscriptions-example/client/node_modules/relay-runtime/lib/store/RelayModernFragmentSpecResolver.js"],"names":["_interopRequireDefault","require","_objectSpread2","_defineProperty2","RelayFeatureFlags","areEqual","invariant","isScalarAndEqual","reportMissingRequiredFields","warning","_require","getPromiseForActiveRequest","_require2","createRequestDescriptor","_require3","areEqualSelectors","createReaderSelector","getSelectorsFromObject","RelayModernFragmentSpecResolver","context","fragments","props","callback","rootIsQueryRenderer","_this","_stale","_callback","_context","_data","_fragments","_props","_resolvers","_rootIsQueryRenderer","setProps","_proto","prototype","dispose","_key","hasOwnProperty","disposeCallback","resolve","prevData","nextData","_key2","resolver","prevItem","nextItem","prop","_nextItem","undefined","setCallback","ownedSelectors","_key3","ownedSelector","kind","SelectorListResolver","environment","_onChange","process","env","NODE_ENV","setSelector","SelectorResolver","setVariables","variables","request","_key4","selector","_this2","snapshot","data","_isMissingData","isMissingData","_missingRequiredFields","missingRequiredFields","_snapshot","lookup","_environment","_selector","_subscription","subscribe","_proto2","ENABLE_RELAY_CONTAINERS_SUSPENSE","_getPromiseForActiveR","promise","owner","getOperationTracker","getPromiseForPendingOperationsAffectingOwner","node","name","requestDescriptor","dataID","_this3","_proto3","forEach","ii","length","slice","push","selectors","pop","disposable","module","exports"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * \n * @format\n */\n// flowlint ambiguous-object-type:error\n'use strict';\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _objectSpread2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectSpread2\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar RelayFeatureFlags = require('../util/RelayFeatureFlags');\n\nvar areEqual = require(\"fbjs/lib/areEqual\");\n\nvar invariant = require('invariant');\n\nvar isScalarAndEqual = require('../util/isScalarAndEqual');\n\nvar reportMissingRequiredFields = require('../util/reportMissingRequiredFields');\n\nvar warning = require(\"fbjs/lib/warning\");\n\nvar _require = require('../query/fetchQueryInternal'),\n    getPromiseForActiveRequest = _require.getPromiseForActiveRequest;\n\nvar _require2 = require('./RelayModernOperationDescriptor'),\n    createRequestDescriptor = _require2.createRequestDescriptor;\n\nvar _require3 = require('./RelayModernSelector'),\n    areEqualSelectors = _require3.areEqualSelectors,\n    createReaderSelector = _require3.createReaderSelector,\n    getSelectorsFromObject = _require3.getSelectorsFromObject;\n\n/**\n * A utility for resolving and subscribing to the results of a fragment spec\n * (key -> fragment mapping) given some \"props\" that determine the root ID\n * and variables to use when reading each fragment. When props are changed via\n * `setProps()`, the resolver will update its results and subscriptions\n * accordingly. Internally, the resolver:\n * - Converts the fragment map & props map into a map of `Selector`s.\n * - Removes any resolvers for any props that became null.\n * - Creates resolvers for any props that became non-null.\n * - Updates resolvers with the latest props.\n *\n * This utility is implemented as an imperative, stateful API for performance\n * reasons: reusing previous resolvers, callback functions, and subscriptions\n * all helps to reduce object allocation and thereby decrease GC time.\n *\n * The `resolve()` function is also lazy and memoized: changes in the store mark\n * the resolver as stale and notify the caller, and the actual results are\n * recomputed the first time `resolve()` is called.\n */\nvar RelayModernFragmentSpecResolver = /*#__PURE__*/function () {\n  function RelayModernFragmentSpecResolver(context, fragments, props, callback, rootIsQueryRenderer) {\n    var _this = this;\n\n    (0, _defineProperty2[\"default\"])(this, \"_onChange\", function () {\n      _this._stale = true;\n\n      if (typeof _this._callback === 'function') {\n        _this._callback();\n      }\n    });\n    this._callback = callback;\n    this._context = context;\n    this._data = {};\n    this._fragments = fragments;\n    this._props = {};\n    this._resolvers = {};\n    this._stale = false;\n    this._rootIsQueryRenderer = rootIsQueryRenderer;\n    this.setProps(props);\n  }\n\n  var _proto = RelayModernFragmentSpecResolver.prototype;\n\n  _proto.dispose = function dispose() {\n    for (var _key in this._resolvers) {\n      if (this._resolvers.hasOwnProperty(_key)) {\n        disposeCallback(this._resolvers[_key]);\n      }\n    }\n  };\n\n  _proto.resolve = function resolve() {\n    if (this._stale) {\n      // Avoid mapping the object multiple times, which could occur if data for\n      // multiple keys changes in the same event loop.\n      var prevData = this._data;\n      var nextData;\n\n      for (var _key2 in this._resolvers) {\n        if (this._resolvers.hasOwnProperty(_key2)) {\n          var resolver = this._resolvers[_key2];\n          var prevItem = prevData[_key2];\n\n          if (resolver) {\n            var nextItem = resolver.resolve();\n\n            if (nextData || nextItem !== prevItem) {\n              nextData = nextData || (0, _objectSpread2[\"default\"])({}, prevData);\n              nextData[_key2] = nextItem;\n            }\n          } else {\n            var prop = this._props[_key2];\n\n            var _nextItem = prop !== undefined ? prop : null;\n\n            if (nextData || !isScalarAndEqual(_nextItem, prevItem)) {\n              nextData = nextData || (0, _objectSpread2[\"default\"])({}, prevData);\n              nextData[_key2] = _nextItem;\n            }\n          }\n        }\n      }\n\n      this._data = nextData || prevData;\n      this._stale = false;\n    }\n\n    return this._data;\n  };\n\n  _proto.setCallback = function setCallback(callback) {\n    this._callback = callback;\n  };\n\n  _proto.setProps = function setProps(props) {\n    var ownedSelectors = getSelectorsFromObject(this._fragments, props);\n    this._props = {};\n\n    for (var _key3 in ownedSelectors) {\n      if (ownedSelectors.hasOwnProperty(_key3)) {\n        var ownedSelector = ownedSelectors[_key3];\n        var resolver = this._resolvers[_key3];\n\n        if (ownedSelector == null) {\n          if (resolver != null) {\n            resolver.dispose();\n          }\n\n          resolver = null;\n        } else if (ownedSelector.kind === 'PluralReaderSelector') {\n          if (resolver == null) {\n            resolver = new SelectorListResolver(this._context.environment, this._rootIsQueryRenderer, ownedSelector, this._onChange);\n          } else {\n            !(resolver instanceof SelectorListResolver) ? process.env.NODE_ENV !== \"production\" ? invariant(false, 'RelayModernFragmentSpecResolver: Expected prop `%s` to always be an array.', _key3) : invariant(false) : void 0;\n            resolver.setSelector(ownedSelector);\n          }\n        } else {\n          if (resolver == null) {\n            resolver = new SelectorResolver(this._context.environment, this._rootIsQueryRenderer, ownedSelector, this._onChange);\n          } else {\n            !(resolver instanceof SelectorResolver) ? process.env.NODE_ENV !== \"production\" ? invariant(false, 'RelayModernFragmentSpecResolver: Expected prop `%s` to always be an object.', _key3) : invariant(false) : void 0;\n            resolver.setSelector(ownedSelector);\n          }\n        }\n\n        this._props[_key3] = props[_key3];\n        this._resolvers[_key3] = resolver;\n      }\n    }\n\n    this._stale = true;\n  };\n\n  _proto.setVariables = function setVariables(variables, request) {\n    for (var _key4 in this._resolvers) {\n      if (this._resolvers.hasOwnProperty(_key4)) {\n        var resolver = this._resolvers[_key4];\n\n        if (resolver) {\n          resolver.setVariables(variables, request);\n        }\n      }\n    }\n\n    this._stale = true;\n  };\n\n  return RelayModernFragmentSpecResolver;\n}();\n/**\n * A resolver for a single Selector.\n */\n\n\nvar SelectorResolver = /*#__PURE__*/function () {\n  function SelectorResolver(environment, rootIsQueryRenderer, selector, callback) {\n    var _this2 = this;\n\n    (0, _defineProperty2[\"default\"])(this, \"_onChange\", function (snapshot) {\n      _this2._data = snapshot.data;\n      _this2._isMissingData = snapshot.isMissingData;\n      _this2._missingRequiredFields = snapshot.missingRequiredFields;\n\n      _this2._callback();\n    });\n\n    var _snapshot = environment.lookup(selector);\n\n    this._callback = callback;\n    this._data = _snapshot.data;\n    this._isMissingData = _snapshot.isMissingData;\n    this._missingRequiredFields = _snapshot.missingRequiredFields;\n    this._environment = environment;\n    this._rootIsQueryRenderer = rootIsQueryRenderer;\n    this._selector = selector;\n    this._subscription = environment.subscribe(_snapshot, this._onChange);\n  }\n\n  var _proto2 = SelectorResolver.prototype;\n\n  _proto2.dispose = function dispose() {\n    if (this._subscription) {\n      this._subscription.dispose();\n\n      this._subscription = null;\n    }\n  };\n\n  _proto2.resolve = function resolve() {\n    if (RelayFeatureFlags.ENABLE_RELAY_CONTAINERS_SUSPENSE === true && this._isMissingData === true) {\n      var _getPromiseForActiveR;\n\n      // NOTE: This branch exists to handle the case in which:\n      // - A RelayModern container is rendered as a descendant of a Relay Hook\n      //   root using a \"partial\" renderPolicy (this means that eargerly\n      //   reading any cached data that is available instead of blocking\n      //   at the root until the whole query is fetched).\n      // - A parent Relay Hook didnt' suspend earlier on data being fetched,\n      //   either because the fragment data for the parent was available, or\n      //   the parent fragment didn't have any data dependencies.\n      // Even though our Flow types reflect the possiblity of null data, there\n      // might still be cases where it's not handled at runtime becuase the\n      // Flow types are being ignored, or simply not being used (for example,\n      // the case reported here: https://fburl.com/srnbucf8, was due to\n      // misuse of Flow types here: https://fburl.com/g3m0mqqh).\n      // Additionally, even though the null data might be handled without a\n      // runtime error, we might not suspend when we intended to if a parent\n      // Relay Hook (e.g. that is using @defer) decided not to suspend becuase\n      // it's immediate data was already available (even if it was deferred),\n      // or it didn't actually need any data (was just spreading other fragments).\n      // This should eventually go away with something like @optional, where we only\n      // suspend at specific boundaries depending on whether the boundary\n      // can be fulfilled or not.\n      var promise = (_getPromiseForActiveR = getPromiseForActiveRequest(this._environment, this._selector.owner)) !== null && _getPromiseForActiveR !== void 0 ? _getPromiseForActiveR : this._environment.getOperationTracker().getPromiseForPendingOperationsAffectingOwner(this._selector.owner);\n\n      if (promise != null) {\n        if (this._rootIsQueryRenderer) {\n          process.env.NODE_ENV !== \"production\" ? warning(false, 'Relay: Relay Container for fragment `%s` has missing data and ' + 'would suspend. When using features such as @defer or @module, ' + 'use `useFragment` instead of a Relay Container.', this._selector.node.name) : void 0;\n        } else {\n          process.env.NODE_ENV !== \"production\" ? warning(false, 'Relay: Relay Container for fragment `%s` suspended. When using ' + 'features such as @defer or @module, use `useFragment` instead ' + 'of a Relay Container.', this._selector.node.name) : void 0;\n          throw promise;\n        }\n      }\n    }\n\n    if (this._missingRequiredFields != null) {\n      reportMissingRequiredFields(this._environment, this._missingRequiredFields);\n    }\n\n    return this._data;\n  };\n\n  _proto2.setSelector = function setSelector(selector) {\n    if (this._subscription != null && areEqualSelectors(selector, this._selector)) {\n      return;\n    }\n\n    this.dispose();\n\n    var snapshot = this._environment.lookup(selector);\n\n    this._data = snapshot.data;\n    this._isMissingData = snapshot.isMissingData;\n    this._missingRequiredFields = snapshot.missingRequiredFields;\n    this._selector = selector;\n    this._subscription = this._environment.subscribe(snapshot, this._onChange);\n  };\n\n  _proto2.setVariables = function setVariables(variables, request) {\n    if (areEqual(variables, this._selector.variables)) {\n      // If we're not actually setting new variables, we don't actually want\n      // to create a new fragment owner, since areEqualSelectors relies on\n      // owner identity.\n      // In fact, we don't even need to try to attempt to set a new selector.\n      // When fragment ownership is not enabled, setSelector will also bail\n      // out since the selector doesn't really change, so we're doing it here\n      // earlier.\n      return;\n    } // NOTE: We manually create the request descriptor here instead of\n    // calling createOperationDescriptor() because we want to set a\n    // descriptor with *unaltered* variables as the fragment owner.\n    // This is a hack that allows us to preserve existing (broken)\n    // behavior of RelayModern containers while using fragment ownership\n    // to propagate variables instead of Context.\n    // For more details, see the summary of D13999308\n\n\n    var requestDescriptor = createRequestDescriptor(request, variables);\n    var selector = createReaderSelector(this._selector.node, this._selector.dataID, variables, requestDescriptor);\n    this.setSelector(selector);\n  };\n\n  return SelectorResolver;\n}();\n/**\n * A resolver for an array of Selectors.\n */\n\n\nvar SelectorListResolver = /*#__PURE__*/function () {\n  function SelectorListResolver(environment, rootIsQueryRenderer, selector, callback) {\n    var _this3 = this;\n\n    (0, _defineProperty2[\"default\"])(this, \"_onChange\", function (data) {\n      _this3._stale = true;\n\n      _this3._callback();\n    });\n    this._callback = callback;\n    this._data = [];\n    this._environment = environment;\n    this._resolvers = [];\n    this._stale = true;\n    this._rootIsQueryRenderer = rootIsQueryRenderer;\n    this.setSelector(selector);\n  }\n\n  var _proto3 = SelectorListResolver.prototype;\n\n  _proto3.dispose = function dispose() {\n    this._resolvers.forEach(disposeCallback);\n  };\n\n  _proto3.resolve = function resolve() {\n    if (this._stale) {\n      // Avoid mapping the array multiple times, which could occur if data for\n      // multiple indices changes in the same event loop.\n      var prevData = this._data;\n      var nextData;\n\n      for (var ii = 0; ii < this._resolvers.length; ii++) {\n        var prevItem = prevData[ii];\n\n        var nextItem = this._resolvers[ii].resolve();\n\n        if (nextData || nextItem !== prevItem) {\n          nextData = nextData || prevData.slice(0, ii);\n          nextData.push(nextItem);\n        }\n      }\n\n      if (!nextData && this._resolvers.length !== prevData.length) {\n        nextData = prevData.slice(0, this._resolvers.length);\n      }\n\n      this._data = nextData || prevData;\n      this._stale = false;\n    }\n\n    return this._data;\n  };\n\n  _proto3.setSelector = function setSelector(selector) {\n    var selectors = selector.selectors;\n\n    while (this._resolvers.length > selectors.length) {\n      var resolver = this._resolvers.pop();\n\n      resolver.dispose();\n    }\n\n    for (var ii = 0; ii < selectors.length; ii++) {\n      if (ii < this._resolvers.length) {\n        this._resolvers[ii].setSelector(selectors[ii]);\n      } else {\n        this._resolvers[ii] = new SelectorResolver(this._environment, this._rootIsQueryRenderer, selectors[ii], this._onChange);\n      }\n    }\n\n    this._stale = true;\n  };\n\n  _proto3.setVariables = function setVariables(variables, request) {\n    this._resolvers.forEach(function (resolver) {\n      return resolver.setVariables(variables, request);\n    });\n\n    this._stale = true;\n  };\n\n  return SelectorListResolver;\n}();\n\nfunction disposeCallback(disposable) {\n  disposable && disposable.dispose();\n}\n\nmodule.exports = RelayModernFragmentSpecResolver;"]},"metadata":{},"sourceType":"script"}