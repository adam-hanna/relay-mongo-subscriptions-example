{"ast":null,"code":"/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * \n * @format\n */\n// flowlint ambiguous-object-type:error\n'use strict';\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _objectSpread2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectSpread2\"));\n\nvar warning = require(\"fbjs/lib/warning\");\n\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\n\nvar _require = require('../util/RelayConcreteNode'),\n    CONDITION = _require.CONDITION,\n    CLIENT_COMPONENT = _require.CLIENT_COMPONENT,\n    CLIENT_EXTENSION = _require.CLIENT_EXTENSION,\n    DEFER = _require.DEFER,\n    FLIGHT_FIELD = _require.FLIGHT_FIELD,\n    FRAGMENT_SPREAD = _require.FRAGMENT_SPREAD,\n    INLINE_FRAGMENT = _require.INLINE_FRAGMENT,\n    LINKED_FIELD = _require.LINKED_FIELD,\n    LINKED_HANDLE = _require.LINKED_HANDLE,\n    MODULE_IMPORT = _require.MODULE_IMPORT,\n    SCALAR_FIELD = _require.SCALAR_FIELD,\n    SCALAR_HANDLE = _require.SCALAR_HANDLE,\n    STREAM = _require.STREAM,\n    TYPE_DISCRIMINATOR = _require.TYPE_DISCRIMINATOR;\n\nvar validateMutation = function validateMutation() {};\n\nif (process.env.NODE_ENV !== \"production\") {\n  var addFieldToDiff = function addFieldToDiff(path, diff, isScalar) {\n    var deepLoc = diff;\n    path.split('.').forEach(function (key, index, arr) {\n      if (deepLoc[key] == null) {\n        deepLoc[key] = {};\n      }\n\n      if (isScalar && index === arr.length - 1) {\n        deepLoc[key] = '<scalar>';\n      }\n\n      deepLoc = deepLoc[key];\n    });\n  };\n\n  validateMutation = function validateMutation(optimisticResponse, mutation, variables) {\n    var operationName = mutation.operation.name;\n    var context = {\n      path: 'ROOT',\n      visitedPaths: new Set(),\n      variables: variables || {},\n      missingDiff: {},\n      extraDiff: {},\n      moduleImportPaths: new Set()\n    };\n    validateSelections(optimisticResponse, mutation.operation.selections, context);\n    validateOptimisticResponse(optimisticResponse, context);\n    process.env.NODE_ENV !== \"production\" ? warning(context.missingDiff.ROOT == null, 'Expected `optimisticResponse` to match structure of server response for mutation `%s`, please define fields for all of\\n%s', operationName, JSON.stringify(context.missingDiff.ROOT, null, 2)) : void 0;\n    process.env.NODE_ENV !== \"production\" ? warning(context.extraDiff.ROOT == null, 'Expected `optimisticResponse` to match structure of server response for mutation `%s`, please remove all fields of\\n%s', operationName, JSON.stringify(context.extraDiff.ROOT, null, 2)) : void 0;\n  };\n\n  var validateSelections = function validateSelections(optimisticResponse, selections, context) {\n    selections.forEach(function (selection) {\n      return validateSelection(optimisticResponse, selection, context);\n    });\n  };\n\n  var validateSelection = function validateSelection(optimisticResponse, selection, context) {\n    switch (selection.kind) {\n      case CONDITION:\n        validateSelections(optimisticResponse, selection.selections, context);\n        return;\n\n      case CLIENT_COMPONENT:\n      case FRAGMENT_SPREAD:\n        validateSelections(optimisticResponse, selection.fragment.selections, context);\n        return;\n\n      case SCALAR_FIELD:\n      case LINKED_FIELD:\n      case FLIGHT_FIELD:\n        return validateField(optimisticResponse, selection, context);\n\n      case INLINE_FRAGMENT:\n        var type = selection.type;\n        var isConcreteType = selection.abstractKey == null;\n        selection.selections.forEach(function (subselection) {\n          if (isConcreteType && optimisticResponse.__typename !== type) {\n            return;\n          }\n\n          validateSelection(optimisticResponse, subselection, context);\n        });\n        return;\n\n      case CLIENT_EXTENSION:\n        selection.selections.forEach(function (subselection) {\n          validateSelection(optimisticResponse, subselection, context);\n        });\n        return;\n\n      case MODULE_IMPORT:\n        return validateModuleImport(context);\n\n      case LINKED_HANDLE:\n      case SCALAR_HANDLE:\n      case DEFER:\n      case STREAM:\n      case TYPE_DISCRIMINATOR:\n        {\n          // TODO(T35864292) - Add missing validations for these types\n          return;\n        }\n\n      default:\n        selection;\n        return;\n    }\n  };\n\n  var validateModuleImport = function validateModuleImport(context) {\n    context.moduleImportPaths.add(context.path);\n  };\n\n  var validateField = function validateField(optimisticResponse, field, context) {\n    var fieldName = field.alias || field.name;\n    var path = \"\".concat(context.path, \".\").concat(fieldName);\n    context.visitedPaths.add(path);\n\n    switch (field.kind) {\n      case SCALAR_FIELD:\n        if (hasOwnProperty.call(optimisticResponse, fieldName) === false) {\n          addFieldToDiff(path, context.missingDiff, true);\n        }\n\n        return;\n\n      case LINKED_FIELD:\n        var selections = field.selections;\n\n        if (optimisticResponse[fieldName] === null || hasOwnProperty.call(optimisticResponse, fieldName) && optimisticResponse[fieldName] === undefined) {\n          return;\n        }\n\n        if (field.plural) {\n          if (Array.isArray(optimisticResponse[fieldName])) {\n            optimisticResponse[fieldName].forEach(function (r) {\n              if (r !== null) {\n                validateSelections(r, selections, (0, _objectSpread2[\"default\"])((0, _objectSpread2[\"default\"])({}, context), {}, {\n                  path: path\n                }));\n              }\n            });\n            return;\n          } else {\n            addFieldToDiff(path, context.missingDiff);\n            return;\n          }\n        } else {\n          if (optimisticResponse[fieldName] instanceof Object) {\n            validateSelections(optimisticResponse[fieldName], selections, (0, _objectSpread2[\"default\"])((0, _objectSpread2[\"default\"])({}, context), {}, {\n              path: path\n            }));\n            return;\n          } else {\n            addFieldToDiff(path, context.missingDiff);\n            return;\n          }\n        }\n\n      case FLIGHT_FIELD:\n        if (optimisticResponse[fieldName] === null || hasOwnProperty.call(optimisticResponse, fieldName) && optimisticResponse[fieldName] === undefined) {\n          return;\n        }\n\n        throw new Error('validateMutation: Flight fields are not compatible with ' + 'optimistic updates, as React does not have the component code ' + 'necessary to process new data on the client. Instead, you ' + 'should update your code to require a full refetch of the Flight ' + 'field so your UI can be updated.');\n    }\n  };\n\n  var validateOptimisticResponse = function validateOptimisticResponse(optimisticResponse, context) {\n    if (Array.isArray(optimisticResponse)) {\n      optimisticResponse.forEach(function (r) {\n        if (r instanceof Object) {\n          validateOptimisticResponse(r, context);\n        }\n      });\n      return;\n    }\n\n    Object.keys(optimisticResponse).forEach(function (key) {\n      var value = optimisticResponse[key];\n      var path = \"\".concat(context.path, \".\").concat(key); // if it's a module import path we don't have an ast so we cannot validate it\n\n      if (context.moduleImportPaths.has(path)) {\n        return;\n      }\n\n      if (!context.visitedPaths.has(path)) {\n        addFieldToDiff(path, context.extraDiff);\n        return;\n      }\n\n      if (value instanceof Object) {\n        validateOptimisticResponse(value, (0, _objectSpread2[\"default\"])((0, _objectSpread2[\"default\"])({}, context), {}, {\n          path: path\n        }));\n      }\n    });\n  };\n}\n\nmodule.exports = validateMutation;","map":{"version":3,"sources":["/home/adamhanna/apps/relay-mongo-subscriptions-example/client/node_modules/relay-runtime/lib/mutations/validateMutation.js"],"names":["_interopRequireDefault","require","_objectSpread2","warning","hasOwnProperty","Object","prototype","_require","CONDITION","CLIENT_COMPONENT","CLIENT_EXTENSION","DEFER","FLIGHT_FIELD","FRAGMENT_SPREAD","INLINE_FRAGMENT","LINKED_FIELD","LINKED_HANDLE","MODULE_IMPORT","SCALAR_FIELD","SCALAR_HANDLE","STREAM","TYPE_DISCRIMINATOR","validateMutation","process","env","NODE_ENV","addFieldToDiff","path","diff","isScalar","deepLoc","split","forEach","key","index","arr","length","optimisticResponse","mutation","variables","operationName","operation","name","context","visitedPaths","Set","missingDiff","extraDiff","moduleImportPaths","validateSelections","selections","validateOptimisticResponse","ROOT","JSON","stringify","selection","validateSelection","kind","fragment","validateField","type","isConcreteType","abstractKey","subselection","__typename","validateModuleImport","add","field","fieldName","alias","concat","call","undefined","plural","Array","isArray","r","Error","keys","value","has","module","exports"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * \n * @format\n */\n// flowlint ambiguous-object-type:error\n'use strict';\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _objectSpread2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectSpread2\"));\n\nvar warning = require(\"fbjs/lib/warning\");\n\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\n\nvar _require = require('../util/RelayConcreteNode'),\n    CONDITION = _require.CONDITION,\n    CLIENT_COMPONENT = _require.CLIENT_COMPONENT,\n    CLIENT_EXTENSION = _require.CLIENT_EXTENSION,\n    DEFER = _require.DEFER,\n    FLIGHT_FIELD = _require.FLIGHT_FIELD,\n    FRAGMENT_SPREAD = _require.FRAGMENT_SPREAD,\n    INLINE_FRAGMENT = _require.INLINE_FRAGMENT,\n    LINKED_FIELD = _require.LINKED_FIELD,\n    LINKED_HANDLE = _require.LINKED_HANDLE,\n    MODULE_IMPORT = _require.MODULE_IMPORT,\n    SCALAR_FIELD = _require.SCALAR_FIELD,\n    SCALAR_HANDLE = _require.SCALAR_HANDLE,\n    STREAM = _require.STREAM,\n    TYPE_DISCRIMINATOR = _require.TYPE_DISCRIMINATOR;\n\nvar validateMutation = function validateMutation() {};\n\nif (process.env.NODE_ENV !== \"production\") {\n  var addFieldToDiff = function addFieldToDiff(path, diff, isScalar) {\n    var deepLoc = diff;\n    path.split('.').forEach(function (key, index, arr) {\n      if (deepLoc[key] == null) {\n        deepLoc[key] = {};\n      }\n\n      if (isScalar && index === arr.length - 1) {\n        deepLoc[key] = '<scalar>';\n      }\n\n      deepLoc = deepLoc[key];\n    });\n  };\n\n  validateMutation = function validateMutation(optimisticResponse, mutation, variables) {\n    var operationName = mutation.operation.name;\n    var context = {\n      path: 'ROOT',\n      visitedPaths: new Set(),\n      variables: variables || {},\n      missingDiff: {},\n      extraDiff: {},\n      moduleImportPaths: new Set()\n    };\n    validateSelections(optimisticResponse, mutation.operation.selections, context);\n    validateOptimisticResponse(optimisticResponse, context);\n    process.env.NODE_ENV !== \"production\" ? warning(context.missingDiff.ROOT == null, 'Expected `optimisticResponse` to match structure of server response for mutation `%s`, please define fields for all of\\n%s', operationName, JSON.stringify(context.missingDiff.ROOT, null, 2)) : void 0;\n    process.env.NODE_ENV !== \"production\" ? warning(context.extraDiff.ROOT == null, 'Expected `optimisticResponse` to match structure of server response for mutation `%s`, please remove all fields of\\n%s', operationName, JSON.stringify(context.extraDiff.ROOT, null, 2)) : void 0;\n  };\n\n  var validateSelections = function validateSelections(optimisticResponse, selections, context) {\n    selections.forEach(function (selection) {\n      return validateSelection(optimisticResponse, selection, context);\n    });\n  };\n\n  var validateSelection = function validateSelection(optimisticResponse, selection, context) {\n    switch (selection.kind) {\n      case CONDITION:\n        validateSelections(optimisticResponse, selection.selections, context);\n        return;\n\n      case CLIENT_COMPONENT:\n      case FRAGMENT_SPREAD:\n        validateSelections(optimisticResponse, selection.fragment.selections, context);\n        return;\n\n      case SCALAR_FIELD:\n      case LINKED_FIELD:\n      case FLIGHT_FIELD:\n        return validateField(optimisticResponse, selection, context);\n\n      case INLINE_FRAGMENT:\n        var type = selection.type;\n        var isConcreteType = selection.abstractKey == null;\n        selection.selections.forEach(function (subselection) {\n          if (isConcreteType && optimisticResponse.__typename !== type) {\n            return;\n          }\n\n          validateSelection(optimisticResponse, subselection, context);\n        });\n        return;\n\n      case CLIENT_EXTENSION:\n        selection.selections.forEach(function (subselection) {\n          validateSelection(optimisticResponse, subselection, context);\n        });\n        return;\n\n      case MODULE_IMPORT:\n        return validateModuleImport(context);\n\n      case LINKED_HANDLE:\n      case SCALAR_HANDLE:\n      case DEFER:\n      case STREAM:\n      case TYPE_DISCRIMINATOR:\n        {\n          // TODO(T35864292) - Add missing validations for these types\n          return;\n        }\n\n      default:\n        selection;\n        return;\n    }\n  };\n\n  var validateModuleImport = function validateModuleImport(context) {\n    context.moduleImportPaths.add(context.path);\n  };\n\n  var validateField = function validateField(optimisticResponse, field, context) {\n    var fieldName = field.alias || field.name;\n    var path = \"\".concat(context.path, \".\").concat(fieldName);\n    context.visitedPaths.add(path);\n\n    switch (field.kind) {\n      case SCALAR_FIELD:\n        if (hasOwnProperty.call(optimisticResponse, fieldName) === false) {\n          addFieldToDiff(path, context.missingDiff, true);\n        }\n\n        return;\n\n      case LINKED_FIELD:\n        var selections = field.selections;\n\n        if (optimisticResponse[fieldName] === null || hasOwnProperty.call(optimisticResponse, fieldName) && optimisticResponse[fieldName] === undefined) {\n          return;\n        }\n\n        if (field.plural) {\n          if (Array.isArray(optimisticResponse[fieldName])) {\n            optimisticResponse[fieldName].forEach(function (r) {\n              if (r !== null) {\n                validateSelections(r, selections, (0, _objectSpread2[\"default\"])((0, _objectSpread2[\"default\"])({}, context), {}, {\n                  path: path\n                }));\n              }\n            });\n            return;\n          } else {\n            addFieldToDiff(path, context.missingDiff);\n            return;\n          }\n        } else {\n          if (optimisticResponse[fieldName] instanceof Object) {\n            validateSelections(optimisticResponse[fieldName], selections, (0, _objectSpread2[\"default\"])((0, _objectSpread2[\"default\"])({}, context), {}, {\n              path: path\n            }));\n            return;\n          } else {\n            addFieldToDiff(path, context.missingDiff);\n            return;\n          }\n        }\n\n      case FLIGHT_FIELD:\n        if (optimisticResponse[fieldName] === null || hasOwnProperty.call(optimisticResponse, fieldName) && optimisticResponse[fieldName] === undefined) {\n          return;\n        }\n\n        throw new Error('validateMutation: Flight fields are not compatible with ' + 'optimistic updates, as React does not have the component code ' + 'necessary to process new data on the client. Instead, you ' + 'should update your code to require a full refetch of the Flight ' + 'field so your UI can be updated.');\n    }\n  };\n\n  var validateOptimisticResponse = function validateOptimisticResponse(optimisticResponse, context) {\n    if (Array.isArray(optimisticResponse)) {\n      optimisticResponse.forEach(function (r) {\n        if (r instanceof Object) {\n          validateOptimisticResponse(r, context);\n        }\n      });\n      return;\n    }\n\n    Object.keys(optimisticResponse).forEach(function (key) {\n      var value = optimisticResponse[key];\n      var path = \"\".concat(context.path, \".\").concat(key); // if it's a module import path we don't have an ast so we cannot validate it\n\n      if (context.moduleImportPaths.has(path)) {\n        return;\n      }\n\n      if (!context.visitedPaths.has(path)) {\n        addFieldToDiff(path, context.extraDiff);\n        return;\n      }\n\n      if (value instanceof Object) {\n        validateOptimisticResponse(value, (0, _objectSpread2[\"default\"])((0, _objectSpread2[\"default\"])({}, context), {}, {\n          path: path\n        }));\n      }\n    });\n  };\n}\n\nmodule.exports = validateMutation;"]},"metadata":{},"sourceType":"script"}